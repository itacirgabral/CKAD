Solution
Run the following command to change the context: -

kubectl config use-context cluster3



Use the following template to create a deployment called ocean-apd: -


---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: ocean-apd
  name: ocean-apd
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ocean-apd
  strategy: 
   type: RollingUpdate
   rollingUpdate:
     maxUnavailable: 45%
     maxSurge: 55%
  template:
    metadata:
      labels:
        app: ocean-apd
    spec:
      containers:
      - image: kodekloud/webapp-color:v1
        name: webapp-color



Now, create the deployment by using the kubectl create -f command in the default namespace: -

kubectl create -f <FILE-NAME>.yaml



After sometime, upgrade the deployment image to kodekloud/webapp-color:v2: -

kubectl set image deploy ocean-apd webapp-color=kodekloud/webapp-color:v2



And check out the rollout history of the deployment ocean-apd: -

kubectl rollout history deploy ocean-apd
deployment.apps/ocean-apd 
REVISION  CHANGE-CAUSE
1         <none>
2         <none>



NOTE: - Revision count is 2. In your lab, it could be different.



On the student-node, store the revision count to the given file: -

echo "2" > /opt/ocean-revision-count.txt



In final task, rollback the deployment image to an old version: -

kubectl rollout undo deployment ocean-apd



Verify the image name by using the following command: -

kubectl describe deploy ocean-apd | grep -i image



It should be kodekloud/webapp-color:v1 image.